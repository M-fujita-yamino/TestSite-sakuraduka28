<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡œå¡š28æœŸï¼šã‚¯ãƒ©ã‚¹å†™çœŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #fff5f8; color: #555; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»æ¤œç´¢å‘¨ã‚Š */
        .search-section { background: white; padding: 30px 20px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 15px rgba(233, 30, 99, 0.1); margin-bottom: 20px; position: sticky; top: 0; z-index: 100; }
        h1 { color: #d81b60; font-size: 22px; margin: 0 0 20px 0; text-align: center; }
        .input-wrap { position: relative; max-width: 400px; margin: 0 auto; }
        input[type="text"] { width: 100%; padding: 15px 20px; border: 2px solid #ffc0cb; border-radius: 30px; outline: none; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        input[type="text"]:focus { border-color: #d81b60; box-shadow: 0 0 8px rgba(216, 27, 96, 0.2); }

        /* å­¦å¹´åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– */
        .tab-group { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .tab { padding: 10px 25px; border: none; border-radius: 20px; background: #ffe0e9; color: #d81b60; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab.active { background: #d81b60; color: white; transform: scale(1.05); }

        /* çµæœè¡¨ç¤ºã‚°ãƒªãƒƒãƒ‰ï¼ˆã“ã“ãŒå…ƒã®æ©Ÿèƒ½ã®ã‚­ãƒ¢ï¼‰ */
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-top: 20px; }
        .photo-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s; animation: fadeIn 0.5s ease forwards; }
        .photo-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        
        .img-box { width: 100%; height: 160px; background: #eee; position: relative; overflow: hidden; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .img-placeholder { display: flex; align-items: center; justify-content: center; height: 100%; color: #ccc; font-size: 12px; }

        .info-box { padding: 15px; border-top: 1px solid #fff0f5; }
        .name-tag { font-weight: bold; font-size: 17px; margin-bottom: 5px; color: #333; }
        .class-tag { display: inline-block; padding: 2px 10px; border-radius: 10px; font-size: 12px; font-weight: bold; }
        .tag-1 { background: #e3f2fd; color: #1e88e5; }
        .tag-2 { background: #fff3e0; color: #f57c00; }
        .tag-3 { background: #f3e5f5; color: #8e24aa; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-result { grid-column: 1 / -1; text-align: center; padding: 50px; color: #bbb; }
    </style>
</head>
<body>

<div class="search-section">
    <h1>ğŸŒ¸ ã‚¯ãƒ©ã‚¹å†™çœŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>
    <div class="input-wrap">
        <input type="text" id="q" placeholder="åå‰ãƒ»ã²ã‚‰ãŒãªã§æ¤œç´¢..." oninput="search()">
    </div>
    <div class="tab-group">
        <button class="tab active" onclick="setG(1, this)">1å¹´</button>
        <button class="tab" onclick="setG(2, this)">2å¹´</button>
        <button class="tab" onclick="setG(3, this)">3å¹´</button>
    </div>
</div>

<div class="container">
    <div id="grid" class="photo-grid">
        <div class="no-result">åŒçª“ç”Ÿã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
    </div>
</div>

<script>
    const MEIBO_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzLqpB8e6tiN06L-urFd1agctJ6JIlfJQW-JcybZ_VrVYOh7D9uwk6PlIlO8wCpcQKVyUKRJOnchn-/pub?gid=0&single=true&output=csv";
    const PHOTO_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxm8bS1RxZlhBjac5oQrMUVpurJbcYUKCPyMAl5Ut26gJ4U-g6pbvdlJryP1c2rUJsWt0eJm-H0Nee/pub?gid=0&single=true&output=csv";

    let meibo = [];
    let photos = {};
    let grade = 1;

    // ã‚¯ãƒ©ã‚¹åæ•´å½¢ï¼ˆ3å¹´ç”Ÿã®Gåˆ—å¯¾ç­–ï¼‰
    function parseC(v) {
        if(!v) return "";
        let s = String(v).trim();
        let m = s.match(/(\d+)$/);
        return m ? m[1] : "";
    }

    async function init() {
        try {
            const [resP, resM] = await Promise.all([fetch(PHOTO_CSV), fetch(MEIBO_CSV)]);
            const txtP = await resP.text();
            txtP.split('\n').slice(1).forEach(l => {
                const c = l.split(',');
                if(c[0]) photos[c[0].trim()] = (c[1]||"").trim();
            });

            const txtM = await resM.text();
            meibo = txtM.replace(/\r/g, '').split('\n').slice(1).map(r => {
                const c = r.split(',');
                return {
                    n: (c[0]||"").trim(),
                    k: (c[1]||"").trim(),
                    cls: [parseC(c[2]), parseC(c[4]), parseC(c[6])] // 1å¹´, 2å¹´, 3å¹´(Gåˆ—)
                };
            }).filter(m => m.n);
        } catch (e) { console.error("Load Error"); }
    }

    function setG(g, btn) {
        grade = g;
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        search();
    }

    function search() {
        const query = document.getElementById('q').value.trim();
        const grid = document.getElementById('grid');
        if (!query) { grid.innerHTML = '<div class="no-result">åŒçª“ç”Ÿã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>'; return; }

        const filtered = meibo.filter(m => m.n.includes(query) || m.k.includes(query));
        if (filtered.length === 0) { grid.innerHTML = '<div class="no-result">è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>'; return; }

        grid.innerHTML = filtered.map(m => {
            const kumi = m.cls[grade - 1];
            const url = photos[grade + "-" + kumi];
            const imgSrc = url ? url : ""; // URLãŒã‚ã‚Œã°è¡¨ç¤º
            
            return `
                <div class="photo-card" onclick="${url ? `window.open('${url}','_blank')` : ''}">
                    <div class="img-box">
                        ${url ? `<img src="${imgSrc}" loading="lazy">` : `<div class="img-placeholder">NO PHOTO<br>ï¼ˆæº–å‚™ä¸­ï¼‰</div>`}
                    </div>
                    <div class="info-box">
                        <div class="name-tag">${m.n}</div>
                        <div class="class-tag tag-${grade}">${grade}å¹´ ${kumi}çµ„</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    init();
</script>

</body>
</html>
