<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡œå¡š28æœŸï¼šã‚¯ãƒ©ã‚¹å†™çœŸæ¤œç´¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ä»¥å‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆCSSï¼‰ã‚’å®Œå…¨ã«å†ç¾ãƒ»ç¶­æŒ */
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #ffeef5; color: #555; margin: 0; padding: 20px; transition: opacity 1s; opacity: 0; }
        .container { max-width: 600px; margin: 0 auto; background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 30px; box-shadow: 0 10px 30px rgba(233, 30, 99, 0.1); border: 2px solid #fff; }
        h1 { color: #d81b60; font-size: 22px; margin-bottom: 25px; text-align: center; font-weight: 700; }
        
        .search-box { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        input[type="text"], select { 
            padding: 12px 20px; border: 2px solid #ffc0cb; border-radius: 25px; 
            font-size: 16px; outline: none; background: white; color: #d81b60; font-family: inherit;
        }
        input::placeholder { color: #ffb6c1; }

        .result-item { 
            background: white; margin-bottom: 15px; padding: 20px; border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #ffe0e9; 
            display: flex; flex-direction: column; gap: 10px; animation: fadeIn 0.5s forwards;
        }
        .result-name { font-weight: bold; font-size: 18px; color: #333; }
        
        /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å†ç¾ */
        .class-btn-container { display: flex; gap: 10px; flex-wrap: wrap; }
        .class-btn { 
            padding: 8px 18px; border-radius: 15px; text-decoration: none; font-size: 13px; 
            font-weight: bold; color: white; transition: 0.3s;
            background: linear-gradient(45deg, #ff8da1, #d81b60);
        }
        .class-btn:hover { transform: scale(1.05); box-shadow: 0 4px 10px rgba(216, 27, 96, 0.3); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ã‚µã‚¯ãƒ©ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼ˆcreateSakuraãŒå¤–éƒ¨ã«ã‚ã‚‹å ´åˆã¯ä¸è¦ã§ã™ãŒã€å®šç¾©ã—ã¦ãŠãã¾ã™ï¼‰ */
        .sakura { position: fixed; top: -10px; z-index: -1; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ¸ ã‚¯ãƒ©ã‚¹å†™çœŸæ¤œç´¢</h1>
    
    <div class="search-box">
        <input type="text" id="nameSearch" placeholder="æ°åã¾ãŸã¯ã²ã‚‰ãŒãªã‚’å…¥åŠ›..." oninput="performSearch()">
        <select id="classSelect" onchange="performSearch()">
            <option value="">ã‚¯ãƒ©ã‚¹ã§çµã‚Šè¾¼ã¿ï¼ˆå…¨å­¦å¹´ï¼‰</option>
            <option value="1-1">1å¹´1çµ„</option><option value="1-2">1å¹´2çµ„</option><option value="1-3">1å¹´3çµ„</option><option value="1-4">1å¹´4çµ„</option><option value="1-5">1å¹´5çµ„</option><option value="1-6">1å¹´6çµ„</option><option value="1-7">1å¹´7çµ„</option><option value="1-8">1å¹´8çµ„</option><option value="1-9">1å¹´9çµ„</option><option value="1-10">1å¹´10çµ„</option>
            <option value="2-1">2å¹´1çµ„</option><option value="2-2">2å¹´2çµ„</option><option value="2-3">2å¹´3çµ„</option><option value="2-4">2å¹´4çµ„</option><option value="2-5">2å¹´5çµ„</option><option value="2-6">2å¹´6çµ„</option><option value="2-7">2å¹´7çµ„</option><option value="2-8">2å¹´8çµ„</option><option value="2-9">2å¹´9çµ„</option><option value="2-10">2å¹´10çµ„</option>
            <option value="3-1">3å¹´1çµ„</option><option value="3-2">3å¹´2çµ„</option><option value="3-3">3å¹´3çµ„</option><option value="3-4">3å¹´4çµ„</option><option value="3-5">3å¹´5çµ„</option><option value="3-6">3å¹´6çµ„</option><option value="3-7">3å¹´7çµ„</option><option value="3-8">3å¹´8çµ„</option><option value="3-9">3å¹´9çµ„</option><option value="3-10">3å¹´10çµ„</option>
        </select>
    </div>

    <div id="searchResult">
        <p style="text-align:center; color:#ffb6c1; font-size:12px;">åç°¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
    </div>
</div>

<script>
    // CSV URLè¨­å®š
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzLqpB8e6tiN06L-urFd1agctJ6JIlfJQW-JcybZ_VrVYOh7D9uwk6PlIlO8wCpcQKVyUKRJOnchn-/pub?gid=0&single=true&output=csv";
    const PHOTO_MASTER_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxm8bS1RxZlhBjac5oQrMUVpurJbcYUKCPyMAl5Ut26gJ4U-g6pbvdlJryP1c2rUJsWt0eJm-H0Nee/pub?gid=0&single=true&output=csv";

    let memberData = [];
    let photoMap = {};

    async function loadData() {
        const out = document.getElementById('searchResult');
        try {
            // å†™çœŸãƒã‚¹ã‚¿ãƒ¼
            const resP = await fetch(PHOTO_MASTER_URL);
            const txtP = await resP.text();
            txtP.split(/\r?\n/).slice(1).forEach(l => {
                const c = l.split(',');
                if(c[0]) photoMap[c[0].trim()] = (c[1] || "").trim();
            });

            // åç°¿
            const resM = await fetch(SHEET_CSV_URL);
            const txtM = await resM.text();
            const rows = txtM.split(/\r?\n/).slice(1);
            const clean = (v) => v ? v.replace('æœˆ','-').replace('æ—¥','').trim() : "";
            
            memberData = rows.map(r => {
                const c = r.split(',');
                return {
                    name: (c[0] || "").trim(),
                    kana: (c[1] || "").trim(),
                    c1: clean(c[2]), c2: clean(c[4]), c3: clean(c[6]), // 3å¹´ç”Ÿ(c[6])ã‚’å®Œå…¨ç¶²ç¾…
                };
            }).filter(m => m.name);

            out.innerHTML = '<p style="text-align:center; color:#2ecc71; font-size:12px;">âœ“ æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚</p>';
        } catch (e) {
            out.innerHTML = '<p style="text-align:center; color:#e74c3c; font-size:12px;">é€šä¿¡ã‚¨ãƒ©ãƒ¼</p>';
        }
    }

    function performSearch() {
        const nameQ = document.getElementById('nameSearch').value.trim();
        const classQ = document.getElementById('classSelect').value;
        const out = document.getElementById('searchResult');
        out.innerHTML = '';
        if (!nameQ && !classQ) return;

        const filtered = memberData.filter(m => {
            const mN = !nameQ || m.name.includes(nameQ) || m.kana.includes(nameQ);
            const mC = !classQ || m.c1 === classQ || m.c2 === classQ || m.c3 === classQ;
            return mN && mC;
        });

        if (filtered.length === 0) {
            out.innerHTML = '<p style="text-align:center; color:#888;">ãªã—</p>';
        } else {
            filtered.forEach(m => {
                const item = document.createElement('div');
                item.className = 'result-item';
                
                // URLã‚’å‹•çš„ã«å–å¾—
                const l1 = photoMap["1-" + m.c1];
                const l2 = photoMap["2-" + m.c2];
                const l3 = photoMap["3-" + m.c3];

                let btns = '<div class="class-btn-container">';
                if(l1) btns += `<a href="${l1}" class="class-btn" target="_blank">1å¹´ ${m.c1}</a>`;
                if(l2) btns += `<a href="${l2}" class="class-btn" target="_blank">2å¹´ ${m.c2}</a>`;
                if(l3) btns += `<a href="${l3}" class="class-btn" target="_blank">3å¹´ ${m.c3}</a>`;
                btns += '</div>';

                item.innerHTML = `<div><span class="result-name">${m.name}</span> <span style="font-size:0.7em; color:#999;">(${m.kana})</span></div>${btns}`;
                out.appendChild(item);
            });
        }
    }

    // ã‚µã‚¯ãƒ©ã‚’é™ã‚‰ã›ã‚‹ç°¡æ˜“ã‚³ãƒ¼ãƒ‰ï¼ˆå¤–éƒ¨JSãŒã‚ã‚‹ãªã‚‰ä¸è¦ï¼‰
    function createSakura() {
        for(let i=0; i<30; i++) {
            const s = document.createElement('div');
            s.className = 'sakura';
            s.innerHTML = 'ğŸŒ¸';
            s.style.left = Math.random() * 100 + 'vw';
            s.style.fontSize = Math.random() * 20 + 10 + 'px';
            s.style.animationDuration = Math.random() * 3 + 2 + 's';
            s.style.opacity = Math.random();
            document.body.appendChild(s);
        }
    }

    window.onload = () => { 
        document.body.style.opacity = 1; 
        createSakura(); 
        loadData(); 
    };
</script>
</body>
</html>
